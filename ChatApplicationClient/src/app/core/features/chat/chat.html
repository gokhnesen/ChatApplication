<div class="chat-container">
  <!-- Chat header with recipient info -->
  <div class="chat-header" *ngIf="receiverUser">
    <!-- Receiver avatar -->
    <img [src]="receiverUser.profilePhotoUrl | profilePhoto" alt="Receiver avatar" class="header-avatar" />
    <div class="header-info">
      <h3>{{ receiverUser?.name }} {{ receiverUser?.lastName }}</h3>
      <span class="unread-badge" *ngIf="unreadCount > 0">{{ unreadCount }} okunmamış</span>
    </div>
  </div>

  <!-- Messages container -->
  <div class="messages" #messagesContainer>
    <ng-container *ngFor="let msg of messages">
      <div class="message-box" [class.own-message]="isOwnMessage(msg)">
        <div class="message-content">
          <div class="message-text">{{ msg.content }}</div>
          <div class="message-footer">
            <small class="message-time">{{ msg.sentAt | date:'short' }}</small>
            <!-- Kendi mesajlarımız için okundu göstergesi -->
            <span class="read-indicator" *ngIf="isOwnMessage(msg)">
              <i [class]="msg.isRead ? 'read-icon' : 'unread-icon'">
                {{ msg.isRead ? '✓✓' : '✓' }}
              </i>
            </span>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Message input form -->
  <form (ngSubmit)="sendMessage()" class="chat-form">
    <!-- Emoji Picker -->
    <div class="emoji-picker-wrapper" *ngIf="showEmojiPicker">
      <emoji-mart 
        (emojiClick)="addEmoji($event)"
        [darkMode]="true"
        [showPreview]="false"
        [perLine]="8"
        [set]="'apple'"
        title="Emoji seç"
        emoji="point_up">
      </emoji-mart>
    </div>

    <div class="input-wrapper">
      <!-- Emoji Button - active class ekle -->
      <button 
        type="button" 
        class="emoji-btn" 
        [class.active]="showEmojiPicker"
        (click)="toggleEmojiPicker()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
          <line x1="9" y1="9" x2="9.01" y2="9"></line>
          <line x1="15" y1="9" x2="15.01" y2="9"></line>
        </svg>
      </button>

      <input [(ngModel)]="messageText" name="message" placeholder="Mesaj yaz..." required />
      
      <button type="submit" [disabled]="!messageText?.trim()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
  </form>
</div>
